from pathlib import Path
import random
from statistics import mean

import matplotlib.pyplot as plt
import numpy as np
import torch
from torch import nn
from tqdm import tqdm

random_seed = 0
np.random.seed(random_seed)
torch.manual_seed(random_seed)
random.seed(random_seed)
torch.backends.cudnn.deterministic = True
torch.backends.cudnn.benchmark = False

import Constants

n_way = 2
n_shot = 5
n_query = Constants.N_QUERY
n_times = 10

DEVICE = "cuda"
n_workers = 1

# from easyfsl.datasets import CUB
from data.Covid.Covid import Covid
from easyfsl.samplers import TaskSampler
from torch.utils.data import DataLoader

batch_size = 10

lossDataFinal = []
valAccuraciesFinal = []
testLossesFinal = []
valLossesFinal = []
for times in range(n_times):
    train_set = Covid(split="test", training=False)
    train_sampler = TaskSampler(
        train_set, n_way=n_way, n_shot=n_shot, n_query=n_query, n_tasks=2
    )

    train_loader = DataLoader(
        train_set,
        batch_sampler=train_sampler,
        collate_fn=train_sampler.episodic_collate_fn,
    )

    # from easyfsl.modules import resnet18
    from torchvision.models import resnet18, ResNet18_Weights
    model = resnet18()
    # model = resnet18(weights=ResNet18_Weights.IMAGENET1K_V1)
    num_ftrs = model.fc.in_features
    model.fc = nn.Linear(num_ftrs, n_way)
    # requiresGrad = True
    # for param in model.parameters():
    #     param.requires_grad = False
    #     # requiresGrad = not requiresGrad
    # for param in model.avgpool.parameters():
    #     param.requires_grad = True
    # for param in model.layer4.parameters():
    #     param.requires_grad = True
    # for param in model.fc.parameters():
    #     param.requires_grad = True
    model = model.to(DEVICE)

    # torch.save(model.state_dict(), "./data/Pascal/BaseResNet")

    # net_state_dict = "./data/Pascal/BaseResNet"
    # model.load_state_dict(torch.load(net_state_dict))

    from torch.optim import SGD, Optimizer
    from torch.optim.lr_scheduler import MultiStepLR
    from torch.utils.tensorboard import SummaryWriter

    LOSS_FUNCTION = nn.CrossEntropyLoss()

    n_epochs = 20
    scheduler_milestones = [5, 10]
    scheduler_gamma = 0.1
    learning_rate = 1e-5
    tb_logs_dir = Path(".")

    # train_optimizer = SGD(
    #     model.parameters(), lr=learning_rate, momentum=0.9, weight_decay=1e-2
    # )

    train_optimizer = torch.optim.Adam(model.parameters(), lr=learning_rate, weight_decay=1e-3)
    train_scheduler = MultiStepLR(
        train_optimizer,
        milestones=scheduler_milestones,
        gamma=scheduler_gamma,
    )

    with tqdm(
            enumerate(train_loader), total=len(train_loader), desc="Training Data sampler"
    ) as tqdm_train:
        for episode_index, (
                support_images,
                support_labels,
                query_images,
                query_labels,
                _,
        ) in tqdm_train:
            if episode_index == 0:
                trainData = {support_images, support_labels}
                valData = {query_images, query_labels}
            else:
                testData = {query_images, query_labels}
                break

    # for i, (x, y) in enumerate(train_loader):
    #     if i == 0:
    #         trainData = {x, y}
    #     if i == 1:
    #         valData = {x, y}
    #     if i == 2:
    #         testData = {x, y}
    #     if i == 3:
    #         break

    losses = []
    valAccuracies = []
    valLoss = []
    for epoch in range(n_epochs):
        model.train()
        torch.cuda.empty_cache()
        train_optimizer.zero_grad()
        inputs, labels = trainData
        outputs = model(inputs.to(DEVICE))
        loss = LOSS_FUNCTION(outputs.to(DEVICE), labels.to(DEVICE))
        loss.backward()
        train_optimizer.step()
        print('Epoch ' + str(epoch) + ' loss ' + str(loss.item()))
        _, pred_t = torch.max(outputs, dim=1)
        correct_t = torch.sum(pred_t == labels.to(DEVICE)).item()
        total_t = labels.size(0)
        print('Epoch ' + str(epoch) + ' trainAccuracy ' + str(100 * correct_t / total_t))

        losses.append(loss.item())
        total_t = 0
        correct_t = 0
        with torch.no_grad():
            model.eval()
            torch.cuda.empty_cache()
            inputs, labels = valData
            outputs = model(inputs.to(DEVICE))
            loss2 = LOSS_FUNCTION(outputs.to(DEVICE), labels.to(DEVICE))
            valLoss.append(loss2.item())
            _, pred_t = torch.max(outputs, dim=1)
            correct_t += torch.sum(pred_t == labels.to(DEVICE)).item()
            total_t += labels.size(0)
            print('Epoch ' + str(epoch) + ' valAccuracy ' + str(100 * correct_t/total_t))
            valAccuracies.append(100 * correct_t/total_t)
    # plt.plot(valLoss)
    # plt.show(block=True)
    print('Loss')
    print(losses)
    print('VALACC')
    print(valAccuracies)
    print('Val Loss')
    print(valLoss)
    lossDataFinal.append(losses)
    valAccuraciesFinal.append(valAccuracies)
    with torch.no_grad():
        model.eval()
        torch.cuda.empty_cache()
        inputs, labels = testData
        outputs = model(inputs.to(DEVICE))
        _, pred_t = torch.max(outputs, dim=1)
        correct_t += torch.sum(pred_t == labels.to(DEVICE)).item()
        total_t += labels.size(0)
        print( 'Test Accuracy' + str(100 * correct_t/total_t))
        testLossesFinal.append(100 * correct_t/total_t)

print('All loss arrays')
print(lossDataFinal)
print('All validation arrays')
print(valAccuraciesFinal)
print('All test losses')
print(testLossesFinal)
print('Average Test loss')
print(np.mean(np.array(testLossesFinal)))

# Normal ResNet
# n_epochs = 100
#     scheduler_milestones = [20, 40]
#     scheduler_gamma = 0.1
#     learning_rate = 1e-5
#All loss arrays
# [[1.500162959098816, 1.4980090856552124, 1.4943368434906006, 1.4892189502716064, 1.4832921028137207, 1.4759575128555298, 1.4678059816360474, 1.4591025114059448, 1.4497222900390625, 1.4398369789123535, 1.4296972751617432, 1.4190185070037842, 1.4087220430374146, 1.3985739946365356, 1.3883419036865234, 1.3784133195877075, 1.3689770698547363, 1.3600659370422363, 1.3508747816085815, 1.3420324325561523, 1.332801342010498, 1.323800802230835, 1.3148291110992432, 1.3058512210845947, 1.296877145767212, 1.287954568862915, 1.2791571617126465, 1.2703365087509155, 1.261487364768982, 1.2529394626617432, 1.2443660497665405, 1.2361085414886475, 1.2275314331054688, 1.219581127166748, 1.2114181518554688, 1.2032939195632935, 1.1955856084823608, 1.1877937316894531, 1.1800239086151123, 1.1725621223449707, 1.1652921438217163, 1.158305048942566, 1.1512951850891113, 1.144392728805542, 1.1375517845153809, 1.1306629180908203, 1.1238892078399658, 1.1174299716949463, 1.1110135316848755, 1.104487657546997, 1.098447322845459, 1.0923125743865967, 1.0861871242523193, 1.0802090167999268, 1.0743422508239746, 1.0683891773223877, 1.062601923942566, 1.0569541454315186, 1.0513542890548706, 1.0457088947296143, 1.0400595664978027, 1.0346457958221436, 1.0291683673858643, 1.023962140083313, 1.0187625885009766, 1.013420820236206, 1.008481740951538, 1.0033352375030518, 0.9985181093215942, 0.9935131072998047, 0.9886614680290222, 0.9837617874145508, 0.9791871905326843, 0.9744794964790344, 0.9697316288948059, 0.965323805809021, 0.9606277346611023, 0.9562259912490845, 0.9518109560012817, 0.9473799467086792, 0.943280041217804, 0.9388567805290222, 0.9347227215766907, 0.9304205179214478, 0.9264094233512878, 0.922204315662384, 0.9182156324386597, 0.9142273664474487, 0.910173237323761, 0.9062908887863159, 0.9023907780647278, 0.898612380027771, 0.8947052955627441, 0.8909808397293091, 0.887154757976532, 0.8835856318473816, 0.8798688650131226, 0.8762348890304565, 0.8726277351379395, 0.8691672086715698], [1.4658925533294678, 1.4638683795928955, 1.460187554359436, 1.4550511837005615, 1.4493911266326904, 1.4428857564926147, 1.4356153011322021, 1.4275575876235962, 1.419060468673706, 1.4103984832763672, 1.4012008905410767, 1.3919188976287842, 1.3826760053634644, 1.373472809791565, 1.363804578781128, 1.3540949821472168, 1.3446075916290283, 1.3351645469665527, 1.3258216381072998, 1.3164862394332886, 1.3070780038833618, 1.2981036901474, 1.2890684604644775, 1.280468225479126, 1.2721489667892456, 1.2633790969848633, 1.2551391124725342, 1.247094988822937, 1.2388899326324463, 1.2308142185211182, 1.223077416419983, 1.2153041362762451, 1.207404375076294, 1.199846625328064, 1.192229151725769, 1.1845556497573853, 1.1771348714828491, 1.1696659326553345, 1.1625179052352905, 1.1551964282989502, 1.148165225982666, 1.1413136720657349, 1.1344926357269287, 1.127947449684143, 1.1213030815124512, 1.1147239208221436, 1.108464002609253, 1.1022076606750488, 1.096131443977356, 1.0898282527923584, 1.0839146375656128, 1.0777777433395386, 1.0720294713974, 1.0662745237350464, 1.0604264736175537, 1.0547258853912354, 1.0493137836456299, 1.043746829032898, 1.03835129737854, 1.0328423976898193, 1.0275849103927612, 1.0225348472595215, 1.0173661708831787, 1.0123261213302612, 1.0070650577545166, 1.0022084712982178, 0.9973672032356262, 0.9924492835998535, 0.9877190589904785, 0.9830004572868347, 0.9782482385635376, 0.9736258387565613, 0.9690957069396973, 0.9645193219184875, 0.9601213335990906, 0.9558372497558594, 0.9516813158988953, 0.9472848773002625, 0.943037211894989, 0.938795268535614, 0.9346275329589844, 0.9304852485656738, 0.9265073537826538, 0.9223312139511108, 0.918420135974884, 0.9144536852836609, 0.9106090664863586, 0.906882107257843, 0.9029629826545715, 0.8993364572525024, 0.8956469297409058, 0.8919375538825989, 0.8883248567581177, 0.8848716616630554, 0.8811413049697876, 0.8776399493217468, 0.8740614056587219, 0.870607852935791, 0.8672916293144226, 0.863787055015564], [1.4532902240753174, 1.4515483379364014, 1.4480539560317993, 1.4428647756576538, 1.4365794658660889, 1.4295705556869507, 1.421263337135315, 1.412519931793213, 1.4035297632217407, 1.393768072128296, 1.384274959564209, 1.374952793121338, 1.3659526109695435, 1.3570259809494019, 1.348516583442688, 1.3400346040725708, 1.3312327861785889, 1.322386622428894, 1.3136454820632935, 1.3048585653305054, 1.2960988283157349, 1.2870991230010986, 1.2782773971557617, 1.269371747970581, 1.2608903646469116, 1.2522863149642944, 1.243890404701233, 1.2355576753616333, 1.227096676826477, 1.218982219696045, 1.2106738090515137, 1.202492356300354, 1.194303274154663, 1.1861112117767334, 1.177808403968811, 1.1698027849197388, 1.161759853363037, 1.1542245149612427, 1.1467069387435913, 1.1391681432724, 1.1319866180419922, 1.1249725818634033, 1.1178869009017944, 1.1109914779663086, 1.1040852069854736, 1.0974128246307373, 1.0907307863235474, 1.0842077732086182, 1.0778603553771973, 1.071425199508667, 1.0651543140411377, 1.0588232278823853, 1.0527809858322144, 1.0467560291290283, 1.040690541267395, 1.0347747802734375, 1.0289825201034546, 1.0232913494110107, 1.0176643133163452, 1.0121204853057861, 1.0064738988876343, 1.0012624263763428, 0.995869517326355, 0.9906188249588013, 0.9854899644851685, 0.9803977012634277, 0.9751501083374023, 0.9703195691108704, 0.9653818011283875, 0.9606382250785828, 0.9558038711547852, 0.9510137438774109, 0.946372389793396, 0.9416908025741577, 0.9369497299194336, 0.932540237903595, 0.9281009435653687, 0.9236653447151184, 0.9192531704902649, 0.9150388836860657, 0.9108539819717407, 0.9067020416259766, 0.9023356437683105, 0.8981608152389526, 0.8940491676330566, 0.8899939656257629, 0.8858949542045593, 0.8820123672485352, 0.878216564655304, 0.8743376731872559, 0.8705326318740845, 0.866603672504425, 0.8629058003425598, 0.859200119972229, 0.8555746078491211, 0.8518590927124023, 0.8483185768127441, 0.8445688486099243, 0.8411359786987305, 0.8375552296638489], [1.4976780414581299, 1.4955394268035889, 1.4914839267730713, 1.4861576557159424, 1.4795351028442383, 1.4720531702041626, 1.4634883403778076, 1.4540587663650513, 1.443979263305664, 1.4336509704589844, 1.4243600368499756, 1.4145991802215576, 1.404863953590393, 1.3956983089447021, 1.3860923051834106, 1.3767306804656982, 1.3671607971191406, 1.3578646183013916, 1.3489526510238647, 1.3401563167572021, 1.331248164176941, 1.3220674991607666, 1.3131523132324219, 1.3042652606964111, 1.2950893640518188, 1.2864875793457031, 1.278045654296875, 1.269710659980774, 1.2612842321395874, 1.2530109882354736, 1.2443004846572876, 1.2362335920333862, 1.2280985116958618, 1.2199742794036865, 1.2120780944824219, 1.2043988704681396, 1.1968207359313965, 1.1892259120941162, 1.1817634105682373, 1.1744740009307861, 1.1669728755950928, 1.159814715385437, 1.1525146961212158, 1.145498275756836, 1.1386077404022217, 1.1317557096481323, 1.12485671043396, 1.1184203624725342, 1.1117651462554932, 1.1054842472076416, 1.099039912223816, 1.0929440259933472, 1.0865893363952637, 1.0808498859405518, 1.0748401880264282, 1.0687917470932007, 1.063044786453247, 1.0572803020477295, 1.051814079284668, 1.0461511611938477, 1.040763020515442, 1.0351879596710205, 1.0297162532806396, 1.0245788097381592, 1.0193172693252563, 1.0140033960342407, 1.0088740587234497, 1.0038235187530518, 0.9988603591918945, 0.9939159154891968, 0.9888998866081238, 0.9840713739395142, 0.9792665243148804, 0.9746297597885132, 0.9700528383255005, 0.9653628468513489, 0.9608062505722046, 0.9561638832092285, 0.9516997337341309, 0.9475327730178833, 0.9430109262466431, 0.9388287663459778, 0.9346328973770142, 0.9303151965141296, 0.9261684417724609, 0.9222239255905151, 0.9179366230964661, 0.9139979481697083, 0.9099574089050293, 0.9060497283935547, 0.9020474553108215, 0.8981512188911438, 0.8943442106246948, 0.8904911875724792, 0.8865871429443359, 0.882929801940918, 0.8792387843132019, 0.8755429983139038, 0.8718250393867493, 0.8682748079299927], [1.4278301000595093, 1.4257097244262695, 1.422240972518921, 1.417255163192749, 1.4114874601364136, 1.4046248197555542, 1.397189736366272, 1.388795018196106, 1.3800121545791626, 1.370948076248169, 1.3614609241485596, 1.3522100448608398, 1.3420355319976807, 1.3321384191513062, 1.3229238986968994, 1.3137338161468506, 1.3045920133590698, 1.2956595420837402, 1.2865049839019775, 1.2779889106750488, 1.2690600156784058, 1.2604451179504395, 1.2520850896835327, 1.2437498569488525, 1.2357056140899658, 1.227433443069458, 1.2191379070281982, 1.210892677307129, 1.20249342918396, 1.1944741010665894, 1.1866037845611572, 1.1785595417022705, 1.1706466674804688, 1.1630723476409912, 1.155410885810852, 1.1481117010116577, 1.140676736831665, 1.1333754062652588, 1.126281499862671, 1.1191257238388062, 1.1121068000793457, 1.1053297519683838, 1.0986238718032837, 1.091850757598877, 1.0852041244506836, 1.0786489248275757, 1.0721356868743896, 1.065887212753296, 1.059413194656372, 1.0531426668167114, 1.0469653606414795, 1.0408289432525635, 1.034794569015503, 1.0287662744522095, 1.0229467153549194, 1.0172580480575562, 1.0116158723831177, 1.0060232877731323, 1.0003517866134644, 0.9951281547546387, 0.9897047281265259, 0.9843050241470337, 0.9791274070739746, 0.9739306569099426, 0.9687984585762024, 0.9637285470962524, 0.9588379859924316, 0.9539839625358582, 0.9491388201713562, 0.9442896842956543, 0.9396732449531555, 0.9349275827407837, 0.9304181933403015, 0.9257594347000122, 0.9212702512741089, 0.9168734550476074, 0.9124128222465515, 0.9082959294319153, 0.9038802981376648, 0.8995364308357239, 0.8955033421516418, 0.8913191556930542, 0.8872312307357788, 0.8832792043685913, 0.8793282508850098, 0.8753372430801392, 0.8713886141777039, 0.867453932762146, 0.8636792302131653, 0.8598185777664185, 0.8560875654220581, 0.8523796796798706, 0.8487741351127625, 0.8451383709907532, 0.8415703773498535, 0.8379716873168945, 0.8344680070877075, 0.8307607769966125, 0.8273900747299194, 0.8238767385482788], [1.4730937480926514, 1.4714767932891846, 1.4681133031845093, 1.4634099006652832, 1.4577322006225586, 1.4512355327606201, 1.4440118074417114, 1.4361902475357056, 1.428063154220581, 1.4194062948226929, 1.4108771085739136, 1.4021223783493042, 1.3927700519561768, 1.3836876153945923, 1.3741447925567627, 1.3646398782730103, 1.3550398349761963, 1.3454385995864868, 1.3362619876861572, 1.3266983032226562, 1.3174821138381958, 1.307935357093811, 1.298769235610962, 1.289249300956726, 1.2800259590148926, 1.2708861827850342, 1.2619175910949707, 1.2528927326202393, 1.2440087795257568, 1.2352309226989746, 1.226547122001648, 1.2181395292282104, 1.2096912860870361, 1.201462745666504, 1.1936378479003906, 1.1856563091278076, 1.1776793003082275, 1.1699830293655396, 1.162484884262085, 1.155021071434021, 1.1476153135299683, 1.140537142753601, 1.133472204208374, 1.126373052597046, 1.1195547580718994, 1.1127495765686035, 1.1058639287948608, 1.099452257156372, 1.0929079055786133, 1.086554765701294, 1.0802745819091797, 1.0739645957946777, 1.0678547620773315, 1.0619947910308838, 1.0559608936309814, 1.0501352548599243, 1.0443426370620728, 1.03877854347229, 1.0330716371536255, 1.0274300575256348, 1.0220690965652466, 1.016717791557312, 1.011352777481079, 1.0062462091445923, 1.0009180307388306, 0.9960123896598816, 0.9907717704772949, 0.9860913157463074, 0.980922520160675, 0.9760076403617859, 0.9711869955062866, 0.9664556384086609, 0.9617975950241089, 0.9570834040641785, 0.9525831937789917, 0.948204517364502, 0.943642258644104, 0.9392056465148926, 0.9348366856575012, 0.9306071400642395, 0.9264596700668335, 0.922179102897644, 0.918075442314148, 0.9139971733093262, 0.9098614454269409, 0.9057952165603638, 0.9017618894577026, 0.897824764251709, 0.8940709829330444, 0.8901342153549194, 0.8863237500190735, 0.8825074434280396, 0.8787388801574707, 0.8750365972518921, 0.8713385462760925, 0.867693305015564, 0.8640289306640625, 0.8606249690055847, 0.8571218252182007, 0.8537299036979675], [1.4198654890060425, 1.418032169342041, 1.414477825164795, 1.4096527099609375, 1.4038251638412476, 1.3971140384674072, 1.390014410018921, 1.3830411434173584, 1.3757888078689575, 1.3680551052093506, 1.3600026369094849, 1.351656198501587, 1.3429187536239624, 1.334657073020935, 1.3261330127716064, 1.317755937576294, 1.3092639446258545, 1.300980567932129, 1.2928681373596191, 1.2849085330963135, 1.276864767074585, 1.2690106630325317, 1.2612192630767822, 1.2533304691314697, 1.2455215454101562, 1.2377201318740845, 1.2299790382385254, 1.2225502729415894, 1.2150081396102905, 1.207667589187622, 1.2001348733901978, 1.192807912826538, 1.1855742931365967, 1.178493618965149, 1.1714260578155518, 1.1645275354385376, 1.1577924489974976, 1.1509077548980713, 1.1442804336547852, 1.137520432472229, 1.130981683731079, 1.1244889497756958, 1.1180005073547363, 1.1117230653762817, 1.105512261390686, 1.0992432832717896, 1.093291997909546, 1.0872193574905396, 1.0812801122665405, 1.0752944946289062, 1.0693615674972534, 1.0637387037277222, 1.0580976009368896, 1.0523215532302856, 1.0467716455459595, 1.0413981676101685, 1.0359013080596924, 1.0305582284927368, 1.025339126586914, 1.020141839981079, 1.0150129795074463, 1.0101242065429688, 1.004805326461792, 1.0000618696212769, 0.9950695037841797, 0.9901657104492188, 0.9855149388313293, 0.9806814193725586, 0.9761213064193726, 0.9715269207954407, 0.9668943285942078, 0.9623854756355286, 0.9579299092292786, 0.9535168409347534, 0.9491637945175171, 0.9448491930961609, 0.940728485584259, 0.9364118576049805, 0.932281494140625, 0.9282416105270386, 0.9240498542785645, 0.9200857877731323, 0.9159353971481323, 0.911933422088623, 0.9081358909606934, 0.9041334986686707, 0.900413990020752, 0.8964719772338867, 0.8927038908004761, 0.8889328241348267, 0.885258674621582, 0.8816712498664856, 0.8779587745666504, 0.8743878602981567, 0.8709090352058411, 0.8672205805778503, 0.8638138771057129, 0.860315203666687, 0.8568123579025269, 0.8533817529678345], [1.4633177518844604, 1.4618380069732666, 1.4585140943527222, 1.453614354133606, 1.4478378295898438, 1.4413261413574219, 1.433863878250122, 1.4260412454605103, 1.417938470840454, 1.4094946384429932, 1.400918960571289, 1.3925930261611938, 1.3844853639602661, 1.375877022743225, 1.367513656616211, 1.3589856624603271, 1.3506219387054443, 1.3419164419174194, 1.3328559398651123, 1.3242114782333374, 1.315438151359558, 1.306684136390686, 1.2985107898712158, 1.2906793355941772, 1.2827484607696533, 1.2748663425445557, 1.267067313194275, 1.2593375444412231, 1.2515056133270264, 1.2437026500701904, 1.2363168001174927, 1.2286672592163086, 1.2211720943450928, 1.213751196861267, 1.206169843673706, 1.1990095376968384, 1.191978931427002, 1.1849530935287476, 1.1781446933746338, 1.1712749004364014, 1.1648051738739014, 1.1578744649887085, 1.1514034271240234, 1.1449220180511475, 1.1385362148284912, 1.1323106288909912, 1.1261303424835205, 1.1199856996536255, 1.1137614250183105, 1.1077044010162354, 1.101876974105835, 1.0959011316299438, 1.090083360671997, 1.084374189376831, 1.0787714719772339, 1.0730136632919312, 1.0675323009490967, 1.0621198415756226, 1.0566660165786743, 1.0512292385101318, 1.0459072589874268, 1.040626049041748, 1.0354893207550049, 1.0303869247436523, 1.0251994132995605, 1.020440697669983, 1.01529860496521, 1.010366439819336, 1.0055484771728516, 1.0006968975067139, 0.9961179494857788, 0.9912325739860535, 0.9867391586303711, 0.9821656346321106, 0.9775900840759277, 0.9730194807052612, 0.9687539935112, 0.9642637372016907, 0.9598865509033203, 0.955647349357605, 0.9514128565788269, 0.947130024433136, 0.9429033398628235, 0.9387530088424683, 0.9346874952316284, 0.9307252764701843, 0.926681399345398, 0.9226373434066772, 0.9186824560165405, 0.914840042591095, 0.9109894633293152, 0.9073022603988647, 0.9034900665283203, 0.8998673558235168, 0.8960110545158386, 0.892349123954773, 0.8887728452682495, 0.8850240707397461, 0.8813663721084595, 0.8779410123825073], [1.4914206266403198, 1.489936113357544, 1.4867597818374634, 1.4824382066726685, 1.4769643545150757, 1.4703693389892578, 1.4629727602005005, 1.455059289932251, 1.446818232536316, 1.4384105205535889, 1.4295217990875244, 1.4207191467285156, 1.4119986295700073, 1.4028782844543457, 1.3934354782104492, 1.383931279182434, 1.3740720748901367, 1.3647807836532593, 1.3553324937820435, 1.345775842666626, 1.3365601301193237, 1.3273783922195435, 1.3182226419448853, 1.308915615081787, 1.2997413873672485, 1.2909629344940186, 1.282340168952942, 1.2739276885986328, 1.2655874490737915, 1.2574288845062256, 1.2493417263031006, 1.241623044013977, 1.2338604927062988, 1.226015329360962, 1.2183783054351807, 1.210705280303955, 1.2031776905059814, 1.1958116292953491, 1.1886996030807495, 1.181552529335022, 1.1743645668029785, 1.1673214435577393, 1.1603728532791138, 1.153452754020691, 1.146711826324463, 1.1399153470993042, 1.1333069801330566, 1.12656569480896, 1.1202503442764282, 1.1140823364257812, 1.1078717708587646, 1.1018027067184448, 1.0958677530288696, 1.089746356010437, 1.0836352109909058, 1.0777709484100342, 1.0718157291412354, 1.0662647485733032, 1.0607036352157593, 1.0550422668457031, 1.0495240688323975, 1.0440716743469238, 1.0386186838150024, 1.0332180261611938, 1.0279719829559326, 1.0227549076080322, 1.0176868438720703, 1.012547254562378, 1.0076407194137573, 1.0025912523269653, 0.9977566003799438, 0.9927576780319214, 0.9879853129386902, 0.9832236170768738, 0.9785193204879761, 0.9740459322929382, 0.9694994688034058, 0.9649964570999146, 0.9604151844978333, 0.9561296701431274, 0.9518381953239441, 0.9475569725036621, 0.9432516098022461, 0.939111053943634, 0.9349110722541809, 0.9308422207832336, 0.9268056154251099, 0.922747015953064, 0.9188088178634644, 0.9147714376449585, 0.9108295440673828, 0.9070571660995483, 0.9031881093978882, 0.8995543718338013, 0.8955580592155457, 0.8920019865036011, 0.8883050084114075, 0.8846837878227234, 0.8811790347099304, 0.8774079084396362], [1.5044591426849365, 1.5024726390838623, 1.4988380670547485, 1.4934399127960205, 1.4872214794158936, 1.479543924331665, 1.4710350036621094, 1.4618828296661377, 1.4529110193252563, 1.4434298276901245, 1.4340943098068237, 1.425163984298706, 1.416134238243103, 1.4071720838546753, 1.3977904319763184, 1.3884624242782593, 1.3793976306915283, 1.3704853057861328, 1.3615792989730835, 1.3526432514190674, 1.3436520099639893, 1.3349740505218506, 1.3258240222930908, 1.3170716762542725, 1.3083730936050415, 1.2997093200683594, 1.291027545928955, 1.2826435565948486, 1.2742657661437988, 1.265885591506958, 1.257431149482727, 1.2495570182800293, 1.2412899732589722, 1.2332327365875244, 1.2252933979034424, 1.2173700332641602, 1.209550142288208, 1.2018098831176758, 1.1945065259933472, 1.1871930360794067, 1.1798465251922607, 1.1726515293121338, 1.1655690670013428, 1.158658742904663, 1.1517800092697144, 1.144869089126587, 1.138197660446167, 1.1316534280776978, 1.125057578086853, 1.1184924840927124, 1.1123186349868774, 1.1059787273406982, 1.099764108657837, 1.093468189239502, 1.0873970985412598, 1.0813705921173096, 1.0752456188201904, 1.0693027973175049, 1.0633600950241089, 1.0575072765350342, 1.0519413948059082, 1.0462877750396729, 1.0406203269958496, 1.0350651741027832, 1.029603362083435, 1.024237871170044, 1.0187108516693115, 1.0135884284973145, 1.0083329677581787, 1.003143310546875, 0.998149037361145, 0.9930002093315125, 0.9879879951477051, 0.9830930829048157, 0.9783333539962769, 0.9735099077224731, 0.9688328504562378, 0.9640472531318665, 0.9593906402587891, 0.9547259211540222, 0.9501882791519165, 0.9457492828369141, 0.9412252306938171, 0.937036395072937, 0.9324925541877747, 0.9281624555587769, 0.9239231944084167, 0.9197511672973633, 0.9155966639518738, 0.9115414619445801, 0.9074481129646301, 0.9035078883171082, 0.8995221853256226, 0.8955906629562378, 0.8917261362075806, 0.8877418637275696, 0.8840231895446777, 0.8803041577339172, 0.8765650987625122, 0.8727931976318359]]
# All validation arrays
# [[37.5, 25.0, 20.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 32.5, 32.5, 35.0, 35.0, 35.0, 35.0, 35.0, 35.0, 35.0, 32.5, 32.5, 32.5, 32.5], [35.0, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 27.5, 27.5], [17.5, 20.0, 22.5, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5], [25.0, 25.0, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 32.5, 32.5, 32.5, 32.5, 32.5], [27.5, 22.5, 22.5, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 20.0, 20.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 20.0, 20.0, 20.0], [25.0, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 17.5, 17.5, 17.5, 17.5, 17.5, 17.5, 17.5, 17.5, 17.5, 15.0, 15.0, 15.0, 15.0, 15.0, 15.0, 15.0], [25.0, 22.5, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5], [25.0, 20.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5], [27.5, 25.0, 27.5, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5, 22.5], [17.5, 20.0, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 22.5, 22.5, 22.5, 22.5, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 25.0]]
# All test losses
# [30.0, 21.25, 27.5, 32.5, 18.75, 22.5, 23.75, 22.5, 27.5, 25.0]
# Average Test loss
# 25.125

# Trasnfer
# All loss arrays
# [[1.6113135814666748, 1.4273805618286133, 1.2584717273712158, 1.1052732467651367, 0.9675858616828918, 0.846152126789093, 0.739845871925354, 0.6476671099662781, 0.5681971907615662, 0.4997425675392151, 0.44037023186683655, 0.38897350430488586, 0.3445325195789337, 0.30615848302841187, 0.2728167772293091, 0.24383506178855896, 0.21846291422843933, 0.19626979529857635, 0.1767813265323639, 0.15952831506729126, 0.1442970633506775, 0.13084283471107483, 0.11897138506174088, 0.1084737554192543, 0.0991995707154274, 0.09099088609218597, 0.08373074233531952, 0.07727821171283722, 0.07155787944793701, 0.06647049635648727], [1.5870507955551147, 1.413231611251831, 1.2531630992889404, 1.1071138381958008, 0.975533127784729, 0.8574422597885132, 0.7522421479225159, 0.6591920256614685, 0.5777384042739868, 0.5066571831703186, 0.4448753297328949, 0.391205370426178, 0.3447282612323761, 0.30431291460990906, 0.26919201016426086, 0.23873722553253174, 0.2122633159160614, 0.18919922411441803, 0.16910098493099213, 0.15154452621936798, 0.1362663358449936, 0.12298186123371124, 0.11139198392629623, 0.10128903388977051, 0.09245733916759491, 0.08471968024969101, 0.07793454825878143, 0.07194729894399643, 0.06667119264602661, 0.0619998462498188], [1.5697057247161865, 1.3942921161651611, 1.2328112125396729, 1.0861029624938965, 0.9537280201911926, 0.835172176361084, 0.7302895784378052, 0.6384153366088867, 0.5583077669143677, 0.48873624205589294, 0.4285832345485687, 0.3767280578613281, 0.33200305700302124, 0.293472558259964, 0.26028233766555786, 0.23168723285198212, 0.20700308680534363, 0.18562620878219604, 0.16706472635269165, 0.15092378854751587, 0.1368010938167572, 0.12444169819355011, 0.11358431726694107, 0.10403192043304443, 0.09562990814447403, 0.08818165957927704, 0.08158425986766815, 0.07572567462921143, 0.07050668448209763, 0.06583420932292938], [1.182428002357483, 1.0225436687469482, 0.882045567035675, 0.7599003911018372, 0.6548717617988586, 0.5652777552604675, 0.488513320684433, 0.42308878898620605, 0.3672301769256592, 0.319385826587677, 0.2784743905067444, 0.24350246787071228, 0.21361462771892548, 0.18806573748588562, 0.16614682972431183, 0.1473875790834427, 0.1313035786151886, 0.11747533082962036, 0.10557924211025238, 0.0953025370836258, 0.08636769652366638, 0.07860194146633148, 0.07181797921657562, 0.06587866693735123, 0.0606495663523674, 0.05604984238743782, 0.051995933055877686, 0.048389021307229996, 0.04517419636249542, 0.04230457544326782], [1.9218066930770874, 1.7314221858978271, 1.5526750087738037, 1.3862534761428833, 1.2328275442123413, 1.0928404331207275, 0.9663464426994324, 0.8528932332992554, 0.7528011798858643, 0.664714515209198, 0.5878164768218994, 0.5212186574935913, 0.4637911319732666, 0.41408291459083557, 0.37113723158836365, 0.3340299725532532, 0.30184444785118103, 0.27383309602737427, 0.2494700700044632, 0.22815611958503723, 0.20941443741321564, 0.1928388476371765, 0.17812126874923706, 0.164998859167099, 0.15327611565589905, 0.14272764325141907, 0.13322019577026367, 0.12460263818502426, 0.11674845218658447, 0.10955610126256943]]
# All validation arrays
# [[25.0, 22.5, 22.5, 27.5, 27.5, 30.0, 32.5, 32.5, 30.0, 32.5, 32.5, 27.5, 30.0, 30.0, 30.0, 30.0, 30.0, 30.0, 35.0, 32.5, 30.0, 30.0, 30.0, 32.5, 30.0, 32.5, 32.5, 27.5, 27.5, 27.5], [15.0, 20.0, 20.0, 17.5, 17.5, 17.5, 20.0, 20.0, 17.5, 17.5, 15.0, 12.5, 12.5, 15.0, 17.5, 17.5, 17.5, 17.5, 20.0, 20.0, 17.5, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 22.5, 22.5], [35.0, 35.0, 40.0, 37.5, 37.5, 42.5, 42.5, 40.0, 37.5, 37.5, 37.5, 37.5, 37.5, 37.5, 37.5, 37.5, 37.5, 40.0, 40.0, 40.0, 37.5, 37.5, 35.0, 35.0, 37.5, 37.5, 37.5, 37.5, 37.5, 37.5], [25.0, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 30.0, 30.0, 37.5, 37.5, 37.5, 35.0, 37.5, 37.5, 37.5, 37.5, 37.5, 40.0, 40.0, 40.0, 42.5, 42.5, 45.0, 42.5, 42.5, 42.5, 42.5, 42.5], [20.0, 22.5, 25.0, 25.0, 27.5, 30.0, 30.0, 32.5, 30.0, 30.0, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 27.5, 25.0, 25.0, 25.0, 25.0, 25.0, 27.5, 27.5, 27.5, 27.5, 30.0, 30.0, 30.0, 30.0]]
# All test losses
# [25.0, 26.25, 41.25, 43.75, 33.75]
# Average Test loss
# 34.0